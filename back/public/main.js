!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=new class{constructor(){this.assets={}}load(e,t){const n=e.length;let o=0;return e.forEach(e=>{const s=new Image;s.onload=()=>{this.assets[e.id]=s,o+=1,o===n&&t(this.assets)},s.src=e.url}),t}get(e){return this.assets[e]}unload(e){delete this.assets[e]}}},function(e,t){e.exports={PLAYER_BOAT:"player_boat",KILLED_BOAT:"killed_boat",TARGET_HIT:"TARGET_HIT",TARGET_NO_HIT:"TARGET_NO_HIT"}},function(e,t){e.exports=class{constructor(e,t="New message"){const n=document.getElementById("alert-template");this.clonedMessageView=n.cloneNode(!0),this.clonedMessageView.id=Date.now(),this.button=this.clonedMessageView.getElementsByClassName("message-button")[0],this.transparentDiv=document.createElement("div"),this.transparentDiv.className="transparent-div";const o=this.clonedMessageView.getElementsByClassName("message-text")[0],s=this.clonedMessageView.getElementsByClassName("message-title")[0];o.innerText=e,s.innerText=t}show(e=(()=>{})){this.button.addEventListener("click",()=>{this.hide(),e()}),this.clonedMessageView.style.display="block",document.getElementsByTagName("body")[0].appendChild(this.transparentDiv),document.getElementsByTagName("body")[0].appendChild(this.clonedMessageView),this.clonedMessageView.animate([{transform:`translateY(-${this.clonedMessageView.offsetTop+this.clonedMessageView.offsetHeight}px)`},{transform:"translateY(0px)"}],{duration:200})}hide(){document.getElementsByTagName("body")[0].removeChild(this.transparentDiv),document.getElementsByTagName("body")[0].removeChild(this.clonedMessageView)}}},function(e,t,n){const o=n(4),s=n(5),i=n(0),r=n(6),a=n(9),d=n(11),h=n(1),l=n(2),c=n(12);let u,m,_,p,g,w;window.onload=()=>{i.load([{id:h.TARGET_NO_HIT,url:"/assets/black-circle.png"},{id:h.TARGET_HIT,url:"/assets/red-cross.png"},{id:h.PLAYER_BOAT,url:"/assets/square-ship.png"},{id:h.KILLED_BOAT,url:"/assets/jeremy.jpg"}],()=>{g=new a,w=new d,u=new o,g.onDisconnect=()=>{new l("An error occured with the server, please reload the page !","Error").show(()=>{document.location.reload(!0)})},g.onError=e=>{new l(e,"Error").show()},g.onJoinableGames=e=>{w.setGameList(e)},g.onLoading=()=>{w.showInfoMessage("Loading game...")},g.onGameEndWithError=e=>{u.clear(),p&&p.endGame("",!1),w.showGameErrorMsg(e)},w.onCreate=(e,t)=>{g.createGame(e,t)},w.onJoin=(e,t)=>{g.joinGame(e,t)},w.onReplay=e=>{g.replay(e)},g.onGamecreated=e=>{w.showGameCode(e)},g.onGameStart=(e,t)=>{w.hideAllForm(),y(t),p.setPlayerBoats(e)}})};const y=e=>{f(e),E(e),p=new r(m,_,g),p.onEndGame=e=>{u.clear(),w.showEndGameForm(e)}},f=e=>{m=new s(e,c.GAME_BOARD)},E=e=>{_=new s(e,c.PLAYER_BOARD)}},function(e,t){e.exports=class{constructor(){this._canvas=document.getElementById("paper"),this.ctx=this._canvas.getContext("2d"),this._initCanvasSize()}clear(){this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight)}_initCanvasSize(){this._canvas.width=window.innerWidth,this._canvas.height=window.innerHeight}}},function(e,t,n){const o=n(0);e.exports=class{constructor(e,t){this._container=t,this._boardSize=e,this._boardElement=null,this._squareElements=[],this.markers=[],this.boats=[],this.onClick=(e,t)=>{},this.draw()}addMarker(e){this.markers.push(e),this.markers.forEach(e=>{this._squareElements[e.y][e.x].style.backgroundImage=`url('${o.get(e.type).src}')`})}_onClick(e,t){for(let n=0;n<this.markers.length;n++){const o=this.markers[n];if(o.x===e&&o.y===t)return!1}return this.onClick(e,t),!0}draw(){const e=document.getElementsByClassName(this._container)[0],t=document.createElement("div");t.className="board";for(let e=0;e<this._boardSize;e++){this._squareElements[e]=[];const n=document.createElement("div");n.className="board-row";for(let t=0;t<this._boardSize;t++){const o=this.buildSquare(e,t);this._squareElements[e][t]=o,n.appendChild(o)}t.appendChild(n)}e.appendChild(t),t.style.height=t.offsetWidth+"px",window.addEventListener("resize",()=>{this._boardElement.style.height=this._boardElement.offsetWidth+"px"}),this._boardElement=t}buildSquare(e,t){const n=document.createElement("div");return n.className="square",n.onclick=()=>{this._onClick(t,e)&&(n.onclick=null)},n}onDestroy(){document.getElementsByClassName(this._container)[0].removeChild(this._boardElement)}}},function(e,t,n){const o=n(7),s=n(1),i=n(8);e.exports=class{constructor(e,t,n){this.gameView=e,this.playerGameView=t,this.socketController=n,this.infoView=new i(this.playerGameView._ctx,this.gameView._y),this._isPlayerTurn=!1,this.onEndGame=e=>{},this.gameView.onClick=(e,t)=>{this._isPlayerTurn&&this.socketController.addNewMarker(e,t)},this.socketController.onNewMarker=(e,t,n,o,s)=>{this.onNewMarker(e,t,n,o,s)},this.socketController.onBoardHited=(e,t,n,o,s)=>{this.onBoardHited(e,t,n,o,s)},this.socketController.onWin=()=>{this.endGame("You win !")},this.socketController.onLoose=()=>{this.endGame("You loose !")},this.socketController.onStartTurn=()=>{this._isPlayerTurn=!0,this.infoView.drawInfo("It's your turn")},this.socketController.onEndTurn=()=>{this._isPlayerTurn=!1,this.infoView.drawInfo("It's the enemy's turn")}}endGame(e,t=!0){this.infoView.clear(),this.gameView.onDestroy(),this.playerGameView.onDestroy(),t&&this.onEndGame(e)}setPlayerBoats(e){this.boats=e,e.forEach(e=>{e.points.forEach(e=>{this.playerGameView.addMarker(new o(e.x,e.y,s.PLAYER_BOAT))})}),this.playerGameView.boats=e}onBoardHited(e,t,n,i,r){const a=n?i?s.KILLED_BOAT:s.TARGET_HIT:s.TARGET_NO_HIT,d=new o(e,t,a);n&&(d.tag=r),i&&this.playerGameView.markers.filter(e=>e.tag===r).forEach(e=>e.type=s.KILLED_BOAT),this.playerGameView.addMarker(d)}onNewMarker(e,t,n,i,r){const a=n?i?s.KILLED_BOAT:s.TARGET_HIT:s.TARGET_NO_HIT,d=new o(e,t,a);n&&(d.tag=r),i&&this.gameView.markers.filter(e=>e.tag===r).forEach(e=>e.type=s.KILLED_BOAT),this.gameView.addMarker(d)}}},function(e,t){e.exports=class{constructor(e,t,n){this.x=e,this.y=t,this.type=n,this.tag=null}}},function(e,t){e.exports=class{constructor(e,t){this.div=document.getElementById("info-view")}clear(){window.clearTimeout(this.timeOut),this.div.innerText=""}drawInfo(e){window.clearTimeout(this.timeOut),this._drawInfo(e,30)}_drawInfo(e,t){window.clearTimeout(this.timeOut),this.div.innerText=`${e}... ${t} seconds remaining`,this.timeOut=window.setTimeout(()=>{const n=t-1;this._drawInfo(e,n)},1e3)}}},function(e,t,n){n(10);e.exports=class{constructor(){this._socket=io(),this.onNewMarker=(e,t,n,o,s)=>{},this.onGamecreated=e=>{},this.onError=e=>{},this.onGameStart=(e,t)=>{},this.onEndTurn=()=>{},this.onStartTurn=()=>{},this.onBoardHited=(e,t,n,o,s)=>{},this.onWin=()=>{},this.onLoose=()=>{},this.onJoinableGames=e=>{},this.onGameEndWithError=e=>{},this.onLoading=()=>{},this.onDisconnect=()=>{},this._socket.on("connect_error",()=>{this.onDisconnect()}),this._socket.on("disconnect",()=>{this.onDisconnect()}),this._socket.on("joinable_games",e=>{this.onJoinableGames(e)}),this._socket.on("loading",()=>{this.onLoading()}),this._socket.on("game_end_with_error",e=>{this.onGameEndWithError(e)}),this._socket.on("player_turn",()=>{this.onStartTurn()}),this._socket.on("win",()=>{this.onWin()}),this._socket.on("loose",()=>{this.onLoose()}),this._socket.on("player_end_turn",()=>{this.onEndTurn()}),this._socket.on("new_marker",({x:e,y:t,touched:n,killed:o,lastBoatTouched:s})=>{this.onNewMarker(e,t,n,o,s)}),this._socket.on("board_hited",({x:e,y:t,touched:n,killed:o,lastBoatTouched:s})=>{this.onBoardHited(e,t,n,o,s)}),this._socket.on("game_code",e=>{this.onGamecreated(e)}),this._socket.on("join_error",()=>{this.onError("The game do not exists")}),this._socket.on("game_start",({board:e,boardSize:t})=>{this.onGameStart(e,t)})}replay(e){this._socket.emit("replay",e)}joinGame(e,t){this._socket.emit("join_game",{pseudo:e,id:t})}createGame(e,t){this._socket.emit("create_game",{pseudo:e,type:t})}addNewMarker(e,t){this._socket.emit("new_marker",{x:e,y:t})}}},function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,n){const o=n(2);e.exports=class{constructor(){this.onJoin=(e,t)=>{},this.onCreate=(e,t)=>{},this.onReplay=e=>{},this._form=document.getElementById("form"),this._createPseudoInput=document.getElementById("create_pseudo"),this._gameTypeInput=document.getElementById("game_type"),this._createButton=document.getElementById("create_button"),this._joinPseudoInput=document.getElementById("join_pseudo"),this._gameIDInput=document.getElementById("game_id"),this._joinButton=document.getElementById("join_button"),this._gameCodeDiv=document.getElementById("game_code"),this._endGameDiv=document.getElementById("end-game"),this._endGameTitle=document.getElementById("end-game-title"),this._endGameReplayButton=document.getElementById("replay_button"),this._endGameQuitButton=document.getElementById("quit_button"),this._boatCannotTouch=document.getElementById("boat-cannot-touch"),this._boardSizeInput=document.getElementById("board-size"),this._gameList=document.getElementById("game-list"),this._endGameReplayButton.onclick=()=>{const e=localStorage.getItem("pseudo");this._endGameReplayButton.disabled=!0,this._endGameQuitButton.disabled=!0,this.onReplay(e)},this._endGameQuitButton.onclick=()=>{this.hideEndGameForm(),this.showForm()},this._createButton.onclick=()=>{const e=this._createPseudoInput.value,t=this._boardSizeInput.value,n=this._boatCannotTouch.checked;let s=this._gameTypeInput.value;if(""!==s&&""!==e)s=`${s}-${n}-${t}`,localStorage.setItem("pseudo",e),this.onCreate(e,s);else{new o("Please fill pseudo and type inputs","Error").show()}},this._joinButton.onclick=()=>{const e=this._joinPseudoInput.value,t=this._gameIDInput.value;if(""!==t&&""!==e)localStorage.setItem("pseudo",e),this.onJoin(e,t);else{new o("Please fill pseudo and game id inputs","Error").show()}},this.readLocalStorage()}readLocalStorage(){const e=localStorage.getItem("pseudo");void 0!==e&&(this._createPseudoInput.value=e,this._joinPseudoInput.value=e)}setGameList(e){this._gameList.innerHTML="",e.forEach(e=>{const t=document.createElement("li");t.innerHTML=`${e.host} <button class="join-button">Join</button>`,t.addEventListener("click",()=>{this.onJoin(this.getPseudo(),e.code)}),this._gameList.appendChild(t)})}getPseudo(){return this._joinPseudoInput.value}showGameCode(e){this.showInfoMessage(`<b>Game code</b>: ${e}`)}showInfoMessage(e){this.hideForm(),this._gameCodeDiv.innerHTML=e,this.showCodeDiv()}hideEndGameForm(){this._endGameDiv.style.display="none"}showEndGameForm(e){this._endGameReplayButton.disabled=!1,this._endGameQuitButton.disabled=!1,this._endGameTitle.innerText=e,this._endGameDiv.style.display="block"}showGameErrorMsg(e){new o(e,"Error").show(),this.hideAllForm(),this.showForm()}hideForm(){this._form.style.display="none"}hideCodeDiv(){this._gameCodeDiv.style.display="none"}showCodeDiv(){this._gameCodeDiv.style.display="inline-block"}showForm(){this._form.style.display="block"}hideAllForm(){this.hideForm(),this.hideCodeDiv(),this.hideEndGameForm()}}},function(e,t){e.exports={GAME_BOARD:"board-container",PLAYER_BOARD:"player-board"}}]);